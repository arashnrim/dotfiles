!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,l){function s(e){try{c(o.next(e))}catch(e){l(e)}}function a(e){try{c(o.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),l=n(2);function s(e){return e.replace(/(\[|\])/g,"\\$1")}i.default.plugins.register({onStart:function(){return o(this,void 0,void 0,(function*(){yield i.default.settings.registerSection("myBacklinksCustomSection",{label:"Backlinks",iconName:"fas fa-hand-point-left"});yield i.default.settings.registerSettings({myBacklinksCustomSettingHeader:{value:"\\n\\n## Backlinks\\n",type:2,section:"myBacklinksCustomSection",public:!0,label:'Heading above list of manual backlinks (use "\\n" as a new line)'},myBacklinksCustomSettingAutoMarkdown:{value:!0,type:3,section:"myBacklinksCustomSection",public:!0,label:"Automatic backlinks section on every note"},myBacklinksCustomSettingTopOrBottom:{value:!0,type:3,section:"myBacklinksCustomSection",public:!0,label:'Place "manual"  backlinks on the bottom (checked) or at the top (unchecked) '},myBacklinksCustomHideBacklinksIfNoneAuto:{value:!1,type:3,section:"myBacklinksCustomSection",public:!0,label:"Hide auto-backlinks section if there are no backlinks (works for preview only, not for panel)"},myBacklinksCustomSettingUseHint:{value:!0,type:3,section:"myBacklinksCustomSection",public:!0,label:"Use text hint if there are no backlinks (manual insert)"},myBacklinksCustomSettingAutoHeader:{value:"Backlinks<br>",type:2,section:"myBacklinksCustomSection",public:!0,label:"Heading above list of backlinks in automatic section and panel (can use html)"},myBacklinksCustomSettingPanelFontAnchors:{value:13,type:1,section:"myBacklinksCustomSection",public:!0,label:"Font size of links in panel (switch notes to see effect)"},myBacklinksCustomSettingUsePanel:{value:!1,type:3,section:"myBacklinksCustomSection",public:!0,label:"Show backlinks in panel (might require restart)"},myBacklinksCustomSettingIgnoreList:{value:[],type:4,section:"myBacklinksCustomSection",public:!1,label:"Ignore notes list"},myBacklinksCustomSettingShowIconOnBacklinks:{value:!1,type:3,section:"myBacklinksCustomSection",public:!0,label:"Show Joplin icon before backlinks (restart Joplin for effect in panel)"}});let e,t=yield i.default.settings.value("myBacklinksCustomSettingUsePanel");t&&(e=yield i.default.views.panels.create("backlinksPanel"),yield i.default.views.panels.setHtml(e,"<h3>Change notes back and forth if you see this</h3>"),yield i.default.views.panels.addScript(e,"./panel.css"),yield i.default.views.panels.show(e)),i.default.settings.onChange(()=>o(this,void 0,void 0,(function*(){let t=yield i.default.settings.value("myBacklinksCustomSettingUsePanel");console.log("panel via option"),console.log(t),t?yield i.default.views.panels.show(e):yield i.default.views.panels.hide(e)}))),yield i.default.commands.register({name:"insertBackReferences",label:"Insert backlinks",iconName:"fas fa-hand-point-left",execute:()=>o(this,void 0,void 0,(function*(){let e,t,n=yield i.default.workspace.selectedNote(),o=n.body,l=!0,a=1,c=yield i.default.settings.value("myBacklinksCustomSettingHeader"),u=!1,r=yield i.default.settings.value("myBacklinksCustomSettingUseHint"),d=yield i.default.settings.value("myBacklinksCustomSettingIgnoreList");for(;l;){e=yield i.default.data.get(["search"],{query:n.id,fields:["id","title","body"],page:a});for(let t=0;t<e.items.length;t++){let n=e.items[t],o=n.body.includes("\x3c!-- backlinks-ignore --\x3e"),i=d.includes(n.id);o||i||(c=c+"\n"+`[${s(n.title)}](:/${n.id})`,u=!0)}e.has_more?a+=1:l=!1}if(!u&&r&&(c+="\n<small><font color='grey'><i>No backlinks</i></font></small>"),yield i.default.settings.value("myBacklinksCustomSettingTopOrBottom"))t=o+c.replace(/\\n/g,"\n");else{let e=o.split("\n");e.splice(1,0,c.replace(/\\n/g,"\n")),t=e.join("\n")}yield i.default.commands.execute("textSelectAll"),yield i.default.commands.execute("replaceSelection",t)}))});const n=i.default.views.dialogs;yield n.create("myBacklinksIgnoreOn"),yield n.create("myBacklinksIgnoreOff");yield i.default.commands.register({name:"backlinksIgnoreListAddCurrent",label:"Add current to ignore list",iconName:"fas fa-hand-point-left",execute:()=>o(this,void 0,void 0,(function*(){}))}),yield i.default.commands.register({name:"backlinksIgnoreListToggleCurrent",label:"Toggle current note in ignore list",iconName:"fas fa-hand-point-left",execute:()=>o(this,void 0,void 0,(function*(){let e=(yield i.default.workspace.selectedNote()).id,t=yield i.default.settings.value("myBacklinksCustomSettingIgnoreList");if(t.includes(e)){let n=t.indexOf(e);n>-1&&t.splice(n,1),alert("Note removed from <br>backlinks ignore list".replace("<br>","\n"))}else{alert("Note added to <br>backlinks ignore list".replace("<br>","\n")),t.push(e)}yield i.default.settings.setValue("myBacklinksCustomSettingIgnoreList",t)}))});const a=yield n.create("myBacklinksIgnoreList");yield i.default.commands.register({name:"backlinksIgnoreListOpen",label:"View Backlinks ignore list",iconName:"fas fa-hand-point-left",execute:()=>o(this,void 0,void 0,(function*(){let e="",t="</select></form>",o=yield i.default.settings.value("myBacklinksCustomSettingIgnoreList");console.log(o);for(let t=0;t<o.length;t++){let n=o[t],l=yield i.default.data.get(["notes",n],{fields:["id","title","body"]});e+=`<option value="${l.id}">${l.title}</option>`}""==e&&(e="No notes in backlinks ignore list"),t+=`<input type='hidden' value='${(new Date).getTime()}'`,e="<b>Notes in ignore list</b><form name='goto'><select style='width:100%' name='gotoid' size='6'>"+e+t,yield n.setHtml(a,e),yield n.setButtons(a,[{id:"ok",title:"Go to selected item"},{id:"cancel"}]);let l=yield n.open(a);if("ok"==l.id)try{yield i.default.commands.execute("openNote",l.formData.goto.gotoid)}catch(e){console.error(e)}}))}),yield i.default.views.menus.create("myBacklinksIgnoreMenu","Backlinks ignore",[{commandName:"backlinksIgnoreListOpen",accelerator:"Ctrl+Alt+L"},{commandName:"backlinksIgnoreListToggleCurrent",accelerator:"Ctrl+Alt+T"}]),yield i.default.views.toolbarButtons.create("insertRefsToolbar","insertBackReferences",l.ToolbarButtonLocation.EditorToolbar),yield i.default.views.menuItems.create("inserRefsMenu","insertBackReferences",l.MenuItemLocation.Note,{accelerator:"Ctrl+Alt+B"});yield i.default.contentScripts.onMessage("backlinks",e=>o(this,void 0,void 0,(function*(){console.info("PostMessagePlugin (CodeMirror ContentScript): Got message:",e);yield i.default.settings.value("myBacklinksCustomSettingTopOrBottom");console.log("got called getFun()");let t=yield i.default.settings.value("myBacklinksCustomSettingAutoMarkdown");if("getContent"==e.type&&t){console.log("getting content");let e=yield i.default.workspace.selectedNote();console.log("activeNote"),console.log(e);e.body;let t,n=!0,o=1,l=yield i.default.settings.value("myBacklinksCustomSettingAutoHeader"),a=yield i.default.settings.value("myBacklinksCustomHideBacklinksIfNoneAuto"),c=(yield i.default.settings.value("myBacklinksCustomSettingShowIconOnBacklinks"))?'<span class="resource-icon fa-joplin"></span>':"",u="",r=!1;for(;n;){t=yield i.default.data.get(["search"],{query:e.id,fields:["id","title","body"],page:o}),console.log(t);let l=yield i.default.settings.value("myBacklinksCustomSettingIgnoreList");for(let e=0;e<t.items.length;e++){let n=t.items[e],o=n.body.includes("\x3c!-- backlinks-ignore --\x3e"),i=l.includes(n.id);o||i||(u=u+""+`${c}<a href="#" onclick="webviewApi.postMessage('backlinks', {type:'openNote',noteId:'${n.id}'})">${s(n.title)}</a><br>`,r=!0)}t.has_more?o+=1:n=!1}r||(u+="\n<small><font color='grey'><i>No backlinks</i></font></small>");let d=u,m=(yield i.default.settings.value("myBacklinksCustomSettingTopOrBottom"),"");return a&&!r||(m=`${l.replace(/\\n/g,"<br>")}${d}`),m}if("openNote"!=e.type)return console.log(e),"";yield i.default.commands.execute("openNote",e.noteId),console.log("open note")}))),i.default.workspace.onNoteSelectionChange(()=>o(this,void 0,void 0,(function*(){if(t=yield i.default.settings.value("myBacklinksCustomSettingUsePanel"),t){let t;console.log("getting content for panel");let n=yield i.default.workspace.selectedNote();console.log("activeNote"),console.log(n);n.body;let o,l=!0,a=1,c=yield i.default.settings.value("myBacklinksCustomSettingAutoHeader"),u=yield i.default.settings.value("myBacklinksCustomSettingPanelFontAnchors"),r=yield i.default.settings.value("myBacklinksCustomSettingShowIconOnBacklinks"),d=yield i.default.settings.globalValue("theme"),m=[1,3].includes(d)?"light":"dark",f=r?`<span class="resource-icon fa-joplin ${m}"></span>`:"",k="",g=!1;for(;l;){o=yield i.default.data.get(["search"],{query:n.id,fields:["id","title","body"],page:a}),console.log(o);let e=yield i.default.settings.value("myBacklinksCustomSettingIgnoreList");for(let t=0;t<o.items.length;t++){let n=o.items[t],i=n.body.includes("\x3c!-- backlinks-ignore --\x3e"),l=e.includes(n.id);i||l||(k=k+""+`<a href="#" onclick="webviewApi.postMessage({type:'openNote',noteId:'${n.id}'})">${f}${s(n.title)}</a><br>`,g=!0)}o.has_more?a+=1:l=!1}g||(k+="\n<small><font color='grey'><i>No backlinks</i></font></small>");let y=k,p="";p=`${c.replace(/\\n/g,"<br>")}${y}`,t=p,t=`<style>a { font-size:${u}px; }</style>${t}`,yield i.default.views.panels.setHtml(e,t)}}))),e&&(yield i.default.views.panels.onMessage(e,e=>o(this,void 0,void 0,(function*(){yield i.default.commands.execute("openNote",e.noteId)})))),console.info("Test plugin started!"),yield i.default.contentScripts.register(l.ContentScriptType.MarkdownItPlugin,"backlinks","./notesReferences.js")}))}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=joplin},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ContentScriptType=t.SettingStorage=t.AppType=t.SettingItemType=t.ToolbarButtonLocation=t.isContextMenuItemLocation=t.MenuItemLocation=t.ImportModuleOutputFormat=t.FileSystemItem=void 0,function(e){e.File="file",e.Directory="directory"}(t.FileSystemItem||(t.FileSystemItem={})),function(e){e.Markdown="md",e.Html="html"}(t.ImportModuleOutputFormat||(t.ImportModuleOutputFormat={})),function(e){e.File="file",e.Edit="edit",e.View="view",e.Note="note",e.Tools="tools",e.Help="help",e.Context="context",e.NoteListContextMenu="noteListContextMenu",e.EditorContextMenu="editorContextMenu",e.FolderContextMenu="folderContextMenu",e.TagContextMenu="tagContextMenu"}(o=t.MenuItemLocation||(t.MenuItemLocation={})),t.isContextMenuItemLocation=function(e){return[o.Context,o.NoteListContextMenu,o.EditorContextMenu,o.FolderContextMenu,o.TagContextMenu].includes(e)},function(e){e.NoteToolbar="noteToolbar",e.EditorToolbar="editorToolbar"}(t.ToolbarButtonLocation||(t.ToolbarButtonLocation={})),function(e){e[e.Int=1]="Int",e[e.String=2]="String",e[e.Bool=3]="Bool",e[e.Array=4]="Array",e[e.Object=5]="Object",e[e.Button=6]="Button"}(t.SettingItemType||(t.SettingItemType={})),function(e){e.Desktop="desktop",e.Mobile="mobile",e.Cli="cli"}(t.AppType||(t.AppType={})),function(e){e[e.Database=1]="Database",e[e.File=2]="File"}(t.SettingStorage||(t.SettingStorage={})),function(e){e.MarkdownItPlugin="markdownItPlugin",e.CodeMirrorPlugin="codeMirrorPlugin"}(t.ContentScriptType||(t.ContentScriptType={}))}]);